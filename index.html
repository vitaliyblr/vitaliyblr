<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GA4 User ID Demo</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BSJHP52DTT"></script>
  <script>
    // UUID генератор
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0,
          v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // Получаем UUID из localStorage или создаём
    let anonId = localStorage.getItem('anon_uuid');
    if (!anonId) {
      anonId = generateUUID();
      localStorage.setItem('anon_uuid', anonId);
    }

    // Переменная для текущего user_id
    let currentUserId = anonId;

    // Инициализация GA
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    gtag('js', new Date());
    gtag('config', 'G-BSJHP52DTT', {
      user_id: currentUserId
    });

    // Отправка события формы
    function submitLead() {
      gtag('event', 'lead_form_submit', {
        user_id: currentUserId,
        method: 'anonymous'
      });
      alert('Lead form sent as anonymous user!');
    }

    // Симуляция логина
    function login() {
      currentUserId = 'user-12345'; // Это ваш зарегистрированный user_id
      gtag('config', 'G-BSJHP52DTT', {
        user_id: currentUserId
      });
      gtag('event', 'login', {
        method: 'manual'
      });
      alert('User logged in!');
    }

    // Повторная отправка формы после логина
    function submitLeadLoggedIn() {
      gtag('event', 'lead_form_submit', {
        user_id: currentUserId,
        method: 'registered'
      });
      alert('Lead form sent as logged-in user!');
    }
  </script>
</head>
<body>
  <h1>GA4 User ID Tracking Demo</h1>

  <button onclick="submitLead()">Submit Lead (Anonymous)</button>
  <button onclick="login()">Login</button>
  <button onclick="submitLeadLoggedIn()">Submit Lead (Logged-in)</button>

</body>
</html>
